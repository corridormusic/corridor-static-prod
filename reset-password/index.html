<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Corridor - Your pathway to learning music.</title>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Corridor - Your pathway to learning music.">
        <meta name="author" content="Corridor Music, LLC">
        <link rel="icon" href="../static/img/favicon.ico">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    <link href="/app.bundle.css?14fac62193aa36af6031" rel="stylesheet"></head>
    <body>
        <div class="static reset-password container-fluid text-center">
            <div class="message center-block"></div>
            <div class="logo"><img src="../static/img/logo-black.png"></img> Corridor</div>

            <div class="row static-section">
                <div class="container">
                    <h1 class="title first">Password Reset</h1>
                    <p class="text">Please verify your e-mail address and<br />enter a new password.</p>
                </div>
            </div>

            <div class="row static-section">
                <div class="container">
                    <form class="reset-form center-block">
                        <div class="form-group text-left">
                            <input id="email" type="email" name="email" class="form-control" placeholder="E-mail">
                        </div>
                        <div class="form-group text-left">
                            <input id="password" type="password" name="password" class="form-control" placeholder="Password">
                        </div>
                        <button id="submit" type="submit" class="btn btn-primary" disabled="true">Reset</button>
                    </form>
                </div>
            </div>

            <nav class="navbar navbar-inverse navbar-fixed-bottom">
                <div class="container text-center">
                    <p><a style="font-weight: 500;" href="https://app.corridormusic.com/">Back To Login</a></p>
                </div>
            </nav>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script>
            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                var results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function validatePassword(password) {
                var regex = new RegExp(".+@([A-Za-z0-9-]+\\.)+[A-Za-z]{2}[A-Za-z]*");
                return regex.exec(password);
            }

            $(function() {
                var updateSubmitButtonEnabledState = function() {
                    var email = $('.reset-form #email').val();
                    var password = $('.reset-form #password').val();

                    if (password && password.length >= 8 && email && validatePassword(email)) {
                        $("#submit").removeAttr("disabled");
                    } else {
                        $("#submit").attr("disabled", true);
                    }
                };
                $("#email").on("change paste keyup", updateSubmitButtonEnabledState);
                $("#password").on("change paste keyup", updateSubmitButtonEnabledState);

                $('.reset-form').on('submit', function(e) { //use on if jQuery 1.7+
                    e.preventDefault();  //prevent form from submitting
                    var token = getParameterByName('token');
                    var email = $('.reset-form #email').val();
                    var password = $('.reset-form #password').val();

                    $("#submit").attr("disabled", true);
                    $.ajax({
                        url: Corridor.API_URL + 'account/reset-password',
                        type: 'PUT',
                        data: { 'email': email, 'password': password, 'token': token },
                        beforeSend: function (xhr) {
                            xhr.setRequestHeader('Authorization', 'bearer 3bd34464-e773-4809-ae5a-4fb220b3b341');
                        },
                        success: function () {
                            $('.message').html($('<div class="alert alert-success">Password change successful.</div>'));
                            $('.message').hide();
                            $('.message').fadeIn('fast');
                        },
                        error: function () {
                            $("#submit").removeAttr("disabled");
                            $('.message').html($('<div class="alert alert-danger">Sorry, there was a problem resetting your password.</div>'));
                            $('.message').hide();
                            $('.message').fadeIn('fast');
                            $('.message').delay(2500).fadeOut('fast');
                        }
                    });
                });
            });
        </script>
    <script type="text/javascript" src="/vendor.bundle.js?14fac62193aa36af6031"></script><script type="text/javascript" src="/app.bundle.js?14fac62193aa36af6031"></script></body>
</html>
